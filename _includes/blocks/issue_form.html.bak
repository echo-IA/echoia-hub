{%- comment -%}
Block wrapper that loads a preset from _data/issue_forms.yml, then calls the core form.
Usage:
  - type: issue_form
    preset: "contact"               # required: key under data.presets
    repo: "owner/repo"              # optional override
    label: "contact"                # optional override
    extra_labels: ["website"]       # optional override
    title_prefix: "[Contact] "      # optional override
    heading: "Get in Touch"         # optional override
    byline: "â€¦"
    icon: "fa-regular fa-envelope"
    wrapper_class: "wrapper style4 special container medium"
    open_in_new_tab: true
{%- endcomment -%}

{%- assign defaults = site.data.issue_forms.defaults -%}
{%- assign preset_key = include.block.preset -%}
{%- assign preset = site.data.issue_forms.presets[preset_key] -%}

{%- if preset -%}
  {%- assign repo   = include.block.repo   | default: preset.repo   | default: defaults.repo -%}
  {%- assign label  = include.block.label  | default: preset.label  -%}
  {%- assign ex_lbl = include.block.extra_labels | default: preset.extra_labels -%}
  {%- assign titlep = include.block.title_prefix | default: preset.title_prefix -%}
  {%- assign head   = include.block.heading | default: preset.heading -%}
  {%- assign by     = include.block.byline  | default: preset.byline -%}
  {%- assign icon   = include.block.icon    | default: preset.icon   -%}
  {%- assign wrap   = include.block.wrapper_class | default: preset.wrapper_class | default: defaults.wrapper_class -%}
  {%- assign newtab = include.block.open_in_new_tab | default: preset.open_in_new_tab | default: defaults.open_in_new_tab -%}
  {%- assign tmpl   = include.block.body_template | default: preset.body_template -%}{%- comment -%} ADD THIS {%- endcomment -%}

  {% include blocks/github_issue_form.html
     repo=repo label=label extra_labels=ex_lbl title_prefix=titlep
     heading=head byline=by icon=icon wrapper_class=wrap open_in_new_tab=newtab
     body_template=tmpl %}{%- comment -%} AND PASS IT HERE {%- endcomment -%}
{%- else -%}
  <div class="notice">issue_form: unknown preset <code>{{ preset_key }}</code>. Define it in <code>_data/issue_forms.yml</code>.</div>
{%- endif -%}
